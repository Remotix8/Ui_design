{"ast":null,"code":"/**\r\n * @fileOverview\r\n * @author Graeme Yeates - github.com/megawac\r\n */\n\n'use strict';\n\nvar Canvas = require('canvas');\nvar Image = Canvas.Image || window.Image;\n\n/**\r\n * If a message was compressed as a PNG image (a compression hack since\r\n * gzipping over WebSockets * is not supported yet), this function places the\r\n * \"image\" in a canvas element then decodes the * \"image\" as a Base64 string.\r\n *\r\n * @private\r\n * @param data - An object containing the PNG data.\r\n * @param callback - Function with the following params:\r\n * @param callback.data - The uncompressed data.\r\n */\nfunction decompressPng(data, callback) {\n  // Uncompresses the data before sending it through (use image/canvas to do so).\n  var image = new Image();\n  // When the image loads, extracts the raw data (JSON message).\n  image.onload = function () {\n    // Creates a local canvas to draw on.\n    var canvas = new Canvas();\n    var context = canvas.getContext('2d');\n\n    // Sets width and height.\n    canvas.width = image.width;\n    canvas.height = image.height;\n\n    // Prevents anti-aliasing and loosing data\n    context.imageSmoothingEnabled = false;\n    context.webkitImageSmoothingEnabled = false;\n    context.mozImageSmoothingEnabled = false;\n\n    // Puts the data into the image.\n    context.drawImage(image, 0, 0);\n    // Grabs the raw, uncompressed data.\n    var imageData = context.getImageData(0, 0, image.width, image.height).data;\n\n    // Constructs the JSON.\n    var jsonData = '';\n    for (var i = 0; i < imageData.length; i += 4) {\n      // RGB\n      jsonData += String.fromCharCode(imageData[i], imageData[i + 1], imageData[i + 2]);\n    }\n    callback(JSON.parse(jsonData));\n  };\n  // Sends the image data to load.\n  image.src = 'data:image/png;base64,' + data;\n}\nmodule.exports = decompressPng;","map":{"version":3,"names":["Canvas","require","Image","window","decompressPng","data","callback","image","onload","canvas","context","getContext","width","height","imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","drawImage","imageData","getImageData","jsonData","i","length","String","fromCharCode","JSON","parse","src","module","exports"],"sources":["C:/git/Ui_design/react_design/node_modules/roslib/src/util/shim/decompressPng.js"],"sourcesContent":["/**\r\n * @fileOverview\r\n * @author Graeme Yeates - github.com/megawac\r\n */\r\n\r\n'use strict';\r\n\r\nvar Canvas = require('canvas');\r\nvar Image = Canvas.Image || window.Image;\r\n\r\n/**\r\n * If a message was compressed as a PNG image (a compression hack since\r\n * gzipping over WebSockets * is not supported yet), this function places the\r\n * \"image\" in a canvas element then decodes the * \"image\" as a Base64 string.\r\n *\r\n * @private\r\n * @param data - An object containing the PNG data.\r\n * @param callback - Function with the following params:\r\n * @param callback.data - The uncompressed data.\r\n */\r\nfunction decompressPng(data, callback) {\r\n  // Uncompresses the data before sending it through (use image/canvas to do so).\r\n  var image = new Image();\r\n  // When the image loads, extracts the raw data (JSON message).\r\n  image.onload = function() {\r\n    // Creates a local canvas to draw on.\r\n    var canvas = new Canvas();\r\n    var context = canvas.getContext('2d');\r\n\r\n    // Sets width and height.\r\n    canvas.width = image.width;\r\n    canvas.height = image.height;\r\n\r\n    // Prevents anti-aliasing and loosing data\r\n    context.imageSmoothingEnabled = false;\r\n    context.webkitImageSmoothingEnabled = false;\r\n    context.mozImageSmoothingEnabled = false;\r\n\r\n    // Puts the data into the image.\r\n    context.drawImage(image, 0, 0);\r\n    // Grabs the raw, uncompressed data.\r\n    var imageData = context.getImageData(0, 0, image.width, image.height).data;\r\n\r\n    // Constructs the JSON.\r\n    var jsonData = '';\r\n    for (var i = 0; i < imageData.length; i += 4) {\r\n      // RGB\r\n      jsonData += String.fromCharCode(imageData[i], imageData[i + 1], imageData[i + 2]);\r\n    }\r\n    callback(JSON.parse(jsonData));\r\n  };\r\n  // Sends the image data to load.\r\n  image.src = 'data:image/png;base64,' + data;\r\n}\r\n\r\nmodule.exports = decompressPng;\r\n"],"mappings":"AAAA;AACA;AACA;AACA;;AAEA,YAAY;;AAEZ,IAAIA,MAAM,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAC9B,IAAIC,KAAK,GAAGF,MAAM,CAACE,KAAK,IAAIC,MAAM,CAACD,KAAK;;AAExC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASE,aAAaA,CAACC,IAAI,EAAEC,QAAQ,EAAE;EACrC;EACA,IAAIC,KAAK,GAAG,IAAIL,KAAK,CAAC,CAAC;EACvB;EACAK,KAAK,CAACC,MAAM,GAAG,YAAW;IACxB;IACA,IAAIC,MAAM,GAAG,IAAIT,MAAM,CAAC,CAAC;IACzB,IAAIU,OAAO,GAAGD,MAAM,CAACE,UAAU,CAAC,IAAI,CAAC;;IAErC;IACAF,MAAM,CAACG,KAAK,GAAGL,KAAK,CAACK,KAAK;IAC1BH,MAAM,CAACI,MAAM,GAAGN,KAAK,CAACM,MAAM;;IAE5B;IACAH,OAAO,CAACI,qBAAqB,GAAG,KAAK;IACrCJ,OAAO,CAACK,2BAA2B,GAAG,KAAK;IAC3CL,OAAO,CAACM,wBAAwB,GAAG,KAAK;;IAExC;IACAN,OAAO,CAACO,SAAS,CAACV,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC;IAC9B;IACA,IAAIW,SAAS,GAAGR,OAAO,CAACS,YAAY,CAAC,CAAC,EAAE,CAAC,EAAEZ,KAAK,CAACK,KAAK,EAAEL,KAAK,CAACM,MAAM,CAAC,CAACR,IAAI;;IAE1E;IACA,IAAIe,QAAQ,GAAG,EAAE;IACjB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,SAAS,CAACI,MAAM,EAAED,CAAC,IAAI,CAAC,EAAE;MAC5C;MACAD,QAAQ,IAAIG,MAAM,CAACC,YAAY,CAACN,SAAS,CAACG,CAAC,CAAC,EAAEH,SAAS,CAACG,CAAC,GAAG,CAAC,CAAC,EAAEH,SAAS,CAACG,CAAC,GAAG,CAAC,CAAC,CAAC;IACnF;IACAf,QAAQ,CAACmB,IAAI,CAACC,KAAK,CAACN,QAAQ,CAAC,CAAC;EAChC,CAAC;EACD;EACAb,KAAK,CAACoB,GAAG,GAAG,wBAAwB,GAAGtB,IAAI;AAC7C;AAEAuB,MAAM,CAACC,OAAO,GAAGzB,aAAa","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}