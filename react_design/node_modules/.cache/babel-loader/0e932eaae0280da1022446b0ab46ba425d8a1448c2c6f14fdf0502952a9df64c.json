{"ast":null,"code":"/**\r\n * Socket event handling utilities for handling events on either\r\n * WebSocket and TCP sockets\r\n *\r\n * Note to anyone reviewing this code: these functions are called\r\n * in the context of their parent object, unless bound\r\n * @fileOverview\r\n */\n'use strict';\n\nvar decompressPng = require('../util/decompressPng');\nvar CBOR = require('cbor-js');\nvar typedArrayTagger = require('../util/cborTypedArrayTags');\nvar BSON = null;\nif (typeof bson !== 'undefined') {\n  BSON = bson().BSON;\n}\n\n/**\r\n * Event listeners for a WebSocket or TCP socket to a JavaScript\r\n * ROS Client. Sets up Messages for a given topic to trigger an\r\n * event on the ROS client.\r\n *\r\n * @namespace SocketAdapter\r\n * @private\r\n */\nfunction SocketAdapter(client) {\n  var decoder = null;\n  if (client.transportOptions.decoder) {\n    decoder = client.transportOptions.decoder;\n  }\n  function handleMessage(message) {\n    if (message.op === 'publish') {\n      client.emit(message.topic, message.msg);\n    } else if (message.op === 'service_response') {\n      client.emit(message.id, message);\n    } else if (message.op === 'call_service') {\n      client.emit(message.service, message);\n    } else if (message.op === 'status') {\n      if (message.id) {\n        client.emit('status:' + message.id, message);\n      } else {\n        client.emit('status', message);\n      }\n    }\n  }\n  function handlePng(message, callback) {\n    if (message.op === 'png') {\n      decompressPng(message.data, callback);\n    } else {\n      callback(message);\n    }\n  }\n  function decodeBSON(data, callback) {\n    if (!BSON) {\n      throw 'Cannot process BSON encoded message without BSON header.';\n    }\n    var reader = new FileReader();\n    reader.onload = function () {\n      var uint8Array = new Uint8Array(this.result);\n      var msg = BSON.deserialize(uint8Array);\n      callback(msg);\n    };\n    reader.readAsArrayBuffer(data);\n  }\n  return {\n    /**\r\n     * Emit a 'connection' event on WebSocket connection.\r\n     *\r\n     * @param {function} event - The argument to emit with the event.\r\n     * @memberof SocketAdapter\r\n     */\n    onopen: function onOpen(event) {\n      client.isConnected = true;\n      client.emit('connection', event);\n    },\n    /**\r\n     * Emit a 'close' event on WebSocket disconnection.\r\n     *\r\n     * @param {function} event - The argument to emit with the event.\r\n     * @memberof SocketAdapter\r\n     */\n    onclose: function onClose(event) {\n      client.isConnected = false;\n      client.emit('close', event);\n    },\n    /**\r\n     * Emit an 'error' event whenever there was an error.\r\n     *\r\n     * @param {function} event - The argument to emit with the event.\r\n     * @memberof SocketAdapter\r\n     */\n    onerror: function onError(event) {\n      client.emit('error', event);\n    },\n    /**\r\n     * Parse message responses from rosbridge and send to the appropriate\r\n     * topic, service, or param.\r\n     *\r\n     * @param {Object} data - The raw JSON message from rosbridge.\r\n     * @memberof SocketAdapter\r\n     */\n    onmessage: function onMessage(data) {\n      if (decoder) {\n        decoder(data.data, function (message) {\n          handleMessage(message);\n        });\n      } else if (typeof Blob !== 'undefined' && data.data instanceof Blob) {\n        decodeBSON(data.data, function (message) {\n          handlePng(message, handleMessage);\n        });\n      } else if (data.data instanceof ArrayBuffer) {\n        var decoded = CBOR.decode(data.data, typedArrayTagger);\n        handleMessage(decoded);\n      } else {\n        var message = JSON.parse(typeof data === 'string' ? data : data.data);\n        handlePng(message, handleMessage);\n      }\n    }\n  };\n}\nmodule.exports = SocketAdapter;","map":{"version":3,"names":["decompressPng","require","CBOR","typedArrayTagger","BSON","bson","SocketAdapter","client","decoder","transportOptions","handleMessage","message","op","emit","topic","msg","id","service","handlePng","callback","data","decodeBSON","reader","FileReader","onload","uint8Array","Uint8Array","result","deserialize","readAsArrayBuffer","onopen","onOpen","event","isConnected","onclose","onClose","onerror","onError","onmessage","onMessage","Blob","ArrayBuffer","decoded","decode","JSON","parse","module","exports"],"sources":["C:/git/Ui_design/react_design/node_modules/roslib/src/core/SocketAdapter.js"],"sourcesContent":["/**\r\n * Socket event handling utilities for handling events on either\r\n * WebSocket and TCP sockets\r\n *\r\n * Note to anyone reviewing this code: these functions are called\r\n * in the context of their parent object, unless bound\r\n * @fileOverview\r\n */\r\n'use strict';\r\n\r\nvar decompressPng = require('../util/decompressPng');\r\nvar CBOR = require('cbor-js');\r\nvar typedArrayTagger = require('../util/cborTypedArrayTags');\r\nvar BSON = null;\r\nif(typeof bson !== 'undefined'){\r\n    BSON = bson().BSON;\r\n}\r\n\r\n/**\r\n * Event listeners for a WebSocket or TCP socket to a JavaScript\r\n * ROS Client. Sets up Messages for a given topic to trigger an\r\n * event on the ROS client.\r\n *\r\n * @namespace SocketAdapter\r\n * @private\r\n */\r\nfunction SocketAdapter(client) {\r\n  var decoder = null;\r\n  if (client.transportOptions.decoder) {\r\n    decoder = client.transportOptions.decoder;\r\n  }\r\n\r\n  function handleMessage(message) {\r\n    if (message.op === 'publish') {\r\n      client.emit(message.topic, message.msg);\r\n    } else if (message.op === 'service_response') {\r\n      client.emit(message.id, message);\r\n    } else if (message.op === 'call_service') {\r\n      client.emit(message.service, message);\r\n    } else if(message.op === 'status'){\r\n      if(message.id){\r\n        client.emit('status:'+message.id, message);\r\n      } else {\r\n        client.emit('status', message);\r\n      }\r\n    }\r\n  }\r\n\r\n  function handlePng(message, callback) {\r\n    if (message.op === 'png') {\r\n      decompressPng(message.data, callback);\r\n    } else {\r\n      callback(message);\r\n    }\r\n  }\r\n\r\n  function decodeBSON(data, callback) {\r\n    if (!BSON) {\r\n      throw 'Cannot process BSON encoded message without BSON header.';\r\n    }\r\n    var reader = new FileReader();\r\n    reader.onload  = function() {\r\n      var uint8Array = new Uint8Array(this.result);\r\n      var msg = BSON.deserialize(uint8Array);\r\n      callback(msg);\r\n    };\r\n    reader.readAsArrayBuffer(data);\r\n  }\r\n\r\n  return {\r\n    /**\r\n     * Emit a 'connection' event on WebSocket connection.\r\n     *\r\n     * @param {function} event - The argument to emit with the event.\r\n     * @memberof SocketAdapter\r\n     */\r\n    onopen: function onOpen(event) {\r\n      client.isConnected = true;\r\n      client.emit('connection', event);\r\n    },\r\n\r\n    /**\r\n     * Emit a 'close' event on WebSocket disconnection.\r\n     *\r\n     * @param {function} event - The argument to emit with the event.\r\n     * @memberof SocketAdapter\r\n     */\r\n    onclose: function onClose(event) {\r\n      client.isConnected = false;\r\n      client.emit('close', event);\r\n    },\r\n\r\n    /**\r\n     * Emit an 'error' event whenever there was an error.\r\n     *\r\n     * @param {function} event - The argument to emit with the event.\r\n     * @memberof SocketAdapter\r\n     */\r\n    onerror: function onError(event) {\r\n      client.emit('error', event);\r\n    },\r\n\r\n    /**\r\n     * Parse message responses from rosbridge and send to the appropriate\r\n     * topic, service, or param.\r\n     *\r\n     * @param {Object} data - The raw JSON message from rosbridge.\r\n     * @memberof SocketAdapter\r\n     */\r\n    onmessage: function onMessage(data) {\r\n      if (decoder) {\r\n        decoder(data.data, function (message) {\r\n          handleMessage(message);\r\n        });\r\n      } else if (typeof Blob !== 'undefined' && data.data instanceof Blob) {\r\n        decodeBSON(data.data, function (message) {\r\n          handlePng(message, handleMessage);\r\n        });\r\n      } else if (data.data instanceof ArrayBuffer) {\r\n        var decoded = CBOR.decode(data.data, typedArrayTagger);\r\n        handleMessage(decoded);\r\n      } else {\r\n        var message = JSON.parse(typeof data === 'string' ? data : data.data);\r\n        handlePng(message, handleMessage);\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nmodule.exports = SocketAdapter;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}